<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/links :: head('Groups')"></head>
<body>
	<!-- Left Panel -->
	<div th:replace="fragments/sidebar :: side"></div>
	<!-- Header-->
	<div id="right-panel" class="right-panel">
		<header th:replace="fragments/header :: headerFrag"></header>
		<!-- /header -->
		
		<div style="text-align: right; font-size: 35px; margin-top: -30px; margin-bottom: 5px;" th:if="${not #lists.isEmpty(group.project)}">
				<span class="badge badge-danger"
					th:text="${group.name}"> </span>
		</div>
		<button style="float: left;"  class="btn btn-primary" data-toggle="modal" data-target="#addProject"><i class="fa fa-desktop"> Add Project</i></button>
		<div th:if="${#lists.isEmpty(group.project)}"
			style="text-align: center; padding: 20px;">
			<img alt="no-record-found" th:src="@{/images/noRecord.jpg}"
				style="margin-bottom: 10px;" />
			<h5 th:text="'Sorry, There are no projects for ' + ${group.name}"></h5>
		</div>
		<p hidden="hidden" id="groupId" th:text="${group.id}"></p>
		<div class="col-md-3" th:each="project : ${group.project}">
			<aside class="profile-nav alt">
				<section class="card">
					<div class="card-header user-header alt bg-dark">
						<div class="media">
							<a href="#"> <img
								class="align-self-center rounded-circle mr-3"
								style="width: 50px; height: 50px;" alt="" src="images/admin.jpg" />
							</a>
							<div class="media-body">
								<h3 class="text-light display-6" id="projectName" style="width: 90%; white-space:nowrap; overflow: hidden; text-overflow: ellipsis;"
									th:text="${project.projectName}">Switch</h3>
								<p th:text="${'Created by, ' + project.createdBy}" style="white-space:nowrap; overflow: hidden; text-overflow: ellipsis;">Project
									Manager</p>
							</div>
						</div>
					</div>
					<p id="idVlas"></p>

					<ul class="list-group list-group-flush">
						<li class="list-group-item"><a href="#"> <i
								class="fa fa-users"></i> Users <span
								class="badge badge-primary pull-right">10</span></a></li>
						<li class="list-group-item"><a href="#"> <i
								class="fa fa-tasks"></i> Document <span
								class="badge badge-danger pull-right">15</span></a></li>
						<li class="list-group-item"><a href="#"> <i
								class="fa fa-bell-o"></i> Notification <span
								class="badge badge-success pull-right">11</span></a></li>
						<li class="list-group-item"><a href="#"> <i
								class="fa fa-comments-o"></i> Message <span
								class="badge badge-warning pull-right r-activity">03</span></a></li>
					</ul>

				</section>
			</aside>
		</div>
	</div>
	
	<div class="modal fade" id="addProject" tabindex="-1" role="dialog" aria-labelledby="mediumModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-md" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="mediumModalLabel">Add Project</h5>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body">
                                <input class="form-control" name="projName" id="projectName" placeholder="Enter Project Name"/>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                                <button type="button" class="btn btn-primary" onclick="addProject()">Add</button>
                            </div>
                        </div>
                    </div>
                </div>

	<div th:replace="fragments/footer :: foot"></div>
	
	<script>
	$(document).ready(function() {
	       $(function() {
	              var token = $("meta[name='_csrf']").attr("content");
	              var header = $("meta[name='_csrf_header']").attr("content");
	              $(document).ajaxSend(function(e, xhr, options) {
	                    xhr.setRequestHeader(header, token);
	              });
	              
	       });
	});
	
		function addProject() {
			var pName=$("#addProject").find('input[name="projName"]').val();
			var username = $('#username').val();
			var groupId = $('#groupId').text();
			var group = {
				id : groupId
			}
			var projectDto = {
				projectName : pName,
				createdBy : username,
				modifiedBy : username,
				group : group
			};
			$.ajax({
				headers : {
					'Accept' : 'application/json',
					'Content-Type' : 'application/json'
				},
				url : '/addProject',
				type : 'POST',
				data : JSON.stringify(projectDto),
				dataType : 'json',
				success : function(data) {
					$('#addProject').modal('hide');
					location.reload();
				},
				xhrFields : {
					withCredentials : true
				}
			});
		}
	</script>

</body>
</html>